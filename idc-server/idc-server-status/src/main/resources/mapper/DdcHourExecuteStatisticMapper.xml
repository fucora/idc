<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.iwellmass.dispatcher.common.dao.DdcHourExecuteStatisticMapper" >
	<resultMap id="BaseResultMap" type="com.iwellmass.dispatcher.common.model.DdcFiveMinuteExecuteStatistic" >
		<id column="ID" property="id" jdbcType="BIGINT" />
		<id column="APP_ID" property="appId" jdbcType="INTEGER" />
		<result column="DATA_TIME" property="dataTime" jdbcType="TIMESTAMP" />
		<result column="TASK_ID" property="taskId" jdbcType="INTEGER" />
		<result column="EXECUTE_SUCCEED" property="executeSucceed" jdbcType="INTEGER" />
		<result column="EXECUTE_FAILED" property="executeFailed" jdbcType="INTEGER" />
		<result column="EXECUTE_TIME_OUT" property="executeTimeOut" jdbcType="INTEGER" />
		<result column="EXECUTE_DURATION" property="executeDuration" jdbcType="DOUBLE" />
		<result column="EXECUTE_MAX_DURATION" property="executeMaxDuration" jdbcType="DOUBLE" />
		<result column="EXECUTE_MIN_DURATION" property="executeMinDuration" jdbcType="DOUBLE" />
	</resultMap>
	<select id="aggregateHistory" resultMap="BaseResultMap">
	  SELECT
	  APP_ID,
	  #{startTime} AS DATA_TIME,
	  TASK_ID,
	  SUM(EXECUTE_SUCCEED) AS EXECUTE_SUCCEED,
	  SUM(EXECUTE_FAILED) AS EXECUTE_FAILED,
	  SUM(EXECUTE_TIME_OUT) AS EXECUTE_TIME_OUT,
	  AVG(EXECUTE_DURATION) AS EXECUTE_DURATION,
	  MAX(EXECUTE_MAX_DURATION) AS EXECUTE_MAX_DURATION,
	  MIN(EXECUTE_MIN_DURATION) AS EXECUTE_MIN_DURATION
	  FROM
	  DDC_FIVE_MINUTE_EXECUTE_STATISTIC
	  WHERE
	  DATA_TIME >= #{startTime}
	  AND DATA_TIME <![CDATA[ < ]]> #{endTime}
	  GROUP BY TASK_ID
  </select>

	<insert id="insertList">
		INSERT INTO DDC_HOUR_EXECUTE_STATISTIC (
		APP_ID,
		DATA_TIME,
		TASK_ID,
		EXECUTE_SUCCEED,
		EXECUTE_FAILED,
		EXECUTE_TIME_OUT,
		EXECUTE_DURATION,
		EXECUTE_MAX_DURATION,
		EXECUTE_MIN_DURATION
		)
		VALUES
		<foreach collection="list" item="item" separator=",">
			(
			#{item.appId},#{item.dataTime},#{item.taskId},
			#{item.executeSucceed},#{item.executeFailed},
			#{item.executeTimeOut},#{item.executeDuration},
			#{item.executeMaxDuration},#{item.executeMinDuration}
			)
		</foreach>
	</insert>
</mapper>