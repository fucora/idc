<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iwellmass.idc.app.mapper.JobRuntimeMapper">


	<select id="selectJobBarrierVO"  resultType="com.iwellmass.idc.app.vo.JobBarrierVO" >
		SELECT
			b.barrier_id,
			b.barrier_group,
			b.barrier_name,
			b.barrier_should_fire_time,
			i.`status` as barrier_status
		FROM
			t_idc_barrier b
			LEFT JOIN t_idc_job_instance i ON b.barrier_id = i.job_id  AND b.barrier_group = i.job_group 
		WHERE
			b.job_id = #{jobKey.jobId}
			AND b.job_group = #{jobKey.jobGroup}
	</select>
	
	
	<select id="selectJobRuntimeList" resultType="com.iwellmass.idc.app.vo.JobRuntimeListVO">
		SELECT
			j.job_id,
			j.job_group,
			j.job_name,
			j.task_id,
			j.assignee,
			COALESCE(t.PREV_FIRE_TIME,-1) AS should_fire_time,
			COALESCE(t.NEXT_FIRE_TIME,-1) AS next_fire_time,
			t.TRIGGER_STATE AS schedule_status 
		FROM
			t_idc_job j
			LEFT JOIN QRTZ_TRIGGERS t ON j.job_id = t.TRIGGER_NAME 
			AND j.job_group = t.TRIGGER_GROUP
		WHERE 1=1
			<if test="jobName!='' AND jobName!=null">
				AND j.job_name LIKE #{q.jobName}
			</if>
			<if test="taskType!='' AND taskType!=null">
				AND j.task_type LIKE #{q.taskType}
			</if>
			<if test="contentType!='' AND contentType!=null">
				AND j.content_type LIKE #{q.contentType}
			</if>
			<if test="assignee!='' AND assignee!=null">
				AND j.assignee = #{q.assignee}
			</if>
	</select>
</mapper>